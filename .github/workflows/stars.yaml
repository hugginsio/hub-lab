name: Get and commit GitHub stars
on: workflow_dispatch
jobs:
  stars:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Setup git
        run: |
          git config user.name 'github-actions[bot]'
          git config user.email 'github-actions[bot]@users.noreply.github.com'
          
          cd $GITHUB_WORKSPACE
          git pull origin main
      - name: Get GitHub stars
        run: |
          mkdir -p stars
          curl https://api.github.com/users/hugginsio/starred -H "Accept: application/json" -s --output stars/stars.json
      - name: Commit stars.json if changed
        run: |
          if [[ $(git status --porcelain | wc -l) -gt 0 ]]; then
            echo "GitHub stars updated. Pushing changes."
            git add stars.json
            git commit -m "Update stars.json ($(env TZ='America/Chicago' date -Im))"
            git push origin main
          else
            echo "No changes to GitHub stars"
          fi
